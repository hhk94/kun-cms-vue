{"remainingRequest":"D:\\code_by_hk\\kun-cms-vue\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\code_by_hk\\kun-cms-vue\\src\\pages\\User\\UserChange.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\code_by_hk\\kun-cms-vue\\src\\pages\\User\\UserChange.vue","mtime":1587636008670},{"path":"D:\\code_by_hk\\kun-cms-vue\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\code_by_hk\\kun-cms-vue\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"D:\\code_by_hk\\kun-cms-vue\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\code_by_hk\\kun-cms-vue\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KDQppbXBvcnQgeyBTdG9yYWdlIH0gZnJvbSAnQC9rdW4vdXRpbHMvc3RvcmFnZScNCnZhciBzdG9yYWdlID0gbmV3IFN0b3JhZ2UoKTsNCmltcG9ydCBDb25maWcgZnJvbSAnQC9jb25maWcnDQppbXBvcnQgQWRtaW4gZnJvbSAnQC9rdW4vYXBpL2FkbWluJw0KZXhwb3J0IGRlZmF1bHQgewoJbmFtZTogJ1VzZXJDaGFuZ2UnLA0KCQ0KCWRhdGEoKSB7DQoJCXJldHVybiB7DQoJCQlkaWFsb2dGb3JtVmlzaWJsZTpmYWxzZSwNCgkJCWltYWdlVXJsOiAnJywNCgkJCWFjdGlvbjonY21zL2FkZF91c2VyX2F2YXRhcicsDQoJCQl1c2VyOnsNCgkJCQlhcHBpZDonJywNCgkJCQluZXdfcHNkOicnLA0KCQkJCW5pY2tfbmFtZTonJywNCgkJCQlwc2Q6JycsDQoJCQkJaWQ6JycsDQoJCQkJYXZhdGFyX2ltZ19pZDonJw0KCQkJfQ0KCQl9DQoJfSwNCgltZXRob2RzOiB7DQoJCWhhbmRsZUF2YXRhclN1Y2Nlc3MocmVzLCBmaWxlKSB7Ly/lpLTlg4/kuIrkvKDmiJDlip8NCgkJCXRoaXMuaW1hZ2VVcmwgPSBVUkwuY3JlYXRlT2JqZWN0VVJMKGZpbGUucmF3KTsNCgkJCXRoaXMudXNlci5hdmF0YXJfaW1nX2lkID0gcmVzLmlkDQoJCQl0aGlzLiRzdG9yZS5nZXR0ZXJzLnRva2VuLmFwcC5hdmF0YXJfaW1nX3VybCA9IHJlcy5kYXRhDQoJCQljb25zb2xlLmxvZygndGhpcy4kc3RvcmUuZ2V0dGVycy50b2tlbi5hcHAuYXZhdGFyX2ltZ191cmwnLHRoaXMuJHN0b3JlLmdldHRlcnMudG9rZW4uYXBwLmF2YXRhcl9pbWdfdXJsKQ0KCQkJdGhpcy4kc3RvcmUuZGlzcGF0Y2goJ0hvbWUvc2V0X3Rva2VuJyx0aGlzLiRzdG9yZS5nZXR0ZXJzLnRva2VuKQ0KCQl9LA0KCQliZWZvcmVBdmF0YXJVcGxvYWQoZmlsZSkgey8v5LiK5Lyg5YmN5pON5L2cDQoJCQljb25zdCBpc0pQRyA9IGZpbGUudHlwZSA9PT0gJ2ltYWdlL2pwZWcnOw0KCQkJY29uc3QgaXNQTkcgPSBmaWxlLnR5cGUgPT09ICdpbWFnZS9wbmcnOw0KCQkJY29uc3QgaXNMdDJNID0gZmlsZS5zaXplIC8gMTAyNCAvIDEwMjQgPCAyOw0KCQkJY29uc29sZS5sb2coZmlsZSkNCgkJCWlmICghaXNKUEcmJiFpc1BORykgew0KCQkJCXRoaXMuJG1lc3NhZ2UuZXJyb3IoJ+S4iuS8oOWktOWDj+WbvueJh+WPquiDveaYryBKUEcvUE5HIOagvOW8jyEnKTsNCgkJCX0NCgkJCWlmICghaXNMdDJNKSB7DQoJCQkJdGhpcy4kbWVzc2FnZS5lcnJvcign5LiK5Lyg5aS05YOP5Zu+54mH5aSn5bCP5LiN6IO96LaF6L+HIDJNQiEnKTsNCgkJCX0NCgkJCXJldHVybiBpc0pQR3x8aXNQTkcgJiYgaXNMdDJNIDsNCgkJfSwNCgkJc3VibWl0KCl7Ly/ngrnlh7vmj5DkuqTkv67mlLkNCgkJCWlmKHRoaXMudXNlci5uZXdfcHNkIT0nJyYmdGhpcy51c2VyLm5ld19wc2QhPW51bGwmJnRoaXMudXNlci5uZXdfcHNkLmxlbmd0aCE9MCl7DQoJCQkJdGhpcy5kaWFsb2dGb3JtVmlzaWJsZSA9ICB0cnVlDQoJCQkJcmV0dXJuOw0KCQkJfQ0KCQkJdGhpcy5jaGFuZ2VfYXhpb3MoKQ0KCQl9LA0KCQlwc2RfcHVzaCgpey8v5aGr5LqG5paw5a+G56CB77yM6ZyA6KaB6aqM6K+B5pen5a+G56CBDQoJCQlpZih0aGlzLnVzZXIucHNkPT0nJ3x8dGhpcy51c2VyLnBzZD09bnVsbHx8dGhpcy51c2VyLnBzZC5sZW5ndGg9PTApew0KCQkJCXRoaXMuJG5vdGlmeS5lcnJvcih7DQoJCQkJCXRpdGxlOiAn6ZSZ6K+vJywNCgkJCQkJbWVzc2FnZTogJ+ivt+Whq+WGmeaXp+WvhueggeWGjeaPkOS6pCcNCgkJCQl9KTsNCgkJCQlyZXR1cm47DQoJCQl9ZWxzZXsNCgkJCQl0aGlzLmNoYW5nZV9heGlvcygpDQoJCQl9DQoJCX0sDQoJCWFzeW5jIGNoYW5nZV9heGlvcygpey8v55So5oi35L+u5pS56K+35rGCDQoJCQlsZXQgcmVzdWx0DQoJCQl0cnkgew0KCQkJCXRoaXMubG9hZGluZyA9IHRydWUNCgkJCQlyZXN1bHQgPSBhd2FpdCBBZG1pbi51c2VyX2NoYW5nZSh0aGlzLnVzZXIpDQoJCQl9IGNhdGNoIChlKSB7DQoJCQkJdGhpcy5sb2FkaW5nID0gZmFsc2UNCgkJCQljb25zb2xlLmxvZyhlKQ0KCQkJfQ0KCQkJaWYocmVzdWx0LmRhdGEuc3RhdGUgPT0gd2luZG93LmcuU1VDQ0VTU19TVEFURSl7DQoJCQkJY29uc29sZS5sb2cocmVzdWx0KQ0KCQkJCXRoaXMuZGlhbG9nRm9ybVZpc2libGUgPSAgZmFsc2UNCgkJCQl0aGlzLiRub3RpZnkoew0KCQkJCQl0aXRsZTogJ+aIkOWKnycsDQoJCQkJCW1lc3NhZ2U6IHJlc3VsdC5kYXRhLm1zZywNCgkJCQkJdHlwZTogJ3N1Y2Nlc3MnDQoJCQkJfSk7DQoJCQkJaWYocmVzdWx0LmRhdGEuY2hhbmdlX3BzZCl7CS8v5aaC5p6c6L+Z5qyh5L+u5pS55L+u5pS55LqG5a+G56CBDQoJCQkJCXRoaXMuJHJvdXRlci5wdXNoKCcvJyk7DQoJCQkJCXN0b3JhZ2UucmVtb3ZlX3N0b3JhZ2UoJ1VTRVJfSU5GTycpDQoJCQkJfWVsc2V7DQoJCQkJCS8vZW1wdHkNCgkJCQl9DQoJCQl9ZWxzZXsNCgkJCQl0aGlzLiRub3RpZnkuZXJyb3Ioew0KCQkJCQl0aXRsZTogJ+mUmeivrycsDQoJCQkJCW1lc3NhZ2U6IHJlc3VsdC5kYXRhLm1zZw0KCQkJCX0pOw0KCQkJfQ0KCQl9LA0KCX0sCgltb3VudGVkKCkgew0KCQl0aGlzLmFjdGlvbiA9IENvbmZpZy5iYXNlVVJMICsgdGhpcy5hY3Rpb24NCgkJLy8gY29uc29sZS5sb2codGhpcy4kc3RvcmUuZ2V0dGVycy50b2tlbikNCgkJdGhpcy51c2VyLm5pY2tfbmFtZSA9IHRoaXMuJHN0b3JlLmdldHRlcnMudG9rZW4uYXBwLm5pY2tfbmFtZQ0KCQl0aGlzLnVzZXIuYXBwaWQgPSB0aGlzLiRzdG9yZS5nZXR0ZXJzLnRva2VuLmFwcC5hcHBfaWQNCgkJdGhpcy51c2VyLmlkID0gdGhpcy4kc3RvcmUuZ2V0dGVycy50b2tlbi5hcHAuaWQNCgkJdGhpcy5pbWFnZVVybCA9IHRoaXMuJHN0b3JlLmdldHRlcnMudG9rZW4uYXBwLmF2YXRhcl9pbWdfdXJsDQoJCWNvbnNvbGUubG9nKCd0aGlzLmltYWdlVXJsJyx0aGlzLmltYWdlVXJsKQ0KCX0KfQo="},{"version":3,"sources":["UserChange.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAqEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"UserChange.vue","sourceRoot":"src/pages/User","sourcesContent":["<template>\n\t<div class=\"user\" >\r\n\t\t<el-breadcrumb separator=\"/\" class=\"bc\">\r\n\t\t\t<el-breadcrumb-item>用户相关</el-breadcrumb-item>\r\n\t\t\t<el-breadcrumb-item>账号资料修改</el-breadcrumb-item>\r\n\t\t</el-breadcrumb>\r\n\t\t<div class=\"center\">\r\n\t\t\t\r\n\t\t\t<div class=\"input-body\">\r\n\t\t\t\t账号：\r\n\t\t\t\t<el-input\r\n\t\t\t\tdisabled\r\n\t\t\t\tsuffix-icon=\"el-icon-user\"\r\n\t\t\t\tv-model=\"user.appid\"\r\n\t\t\t\t>\r\n\t\t\t\t</el-input>\r\n\t\t\t</div>\r\n\t\t\t<div class=\"input-body\">\r\n\t\t\t\t昵称：\r\n\t\t\t\t<el-input\r\n\t\t\t\tv-model=\"user.nick_name\"\r\n\t\t\t\tsuffix-icon=\"el-icon-mouse\"\r\n\t\t\t\t>\r\n\t\t\t\t</el-input>\r\n\t\t\t</div>\r\n\t\t\t<div class=\"input-body\">\r\n\t\t\t\t新密码：\r\n\t\t\t\t<el-input\r\n\t\t\t\tv-model=\"user.new_psd\"\r\n\t\t\t\tsuffix-icon=\"el-icon-goods\"\r\n\t\t\t\t>\r\n\t\t\t\t</el-input>\r\n\t\t\t</div>\r\n\t\t\t<div class=\"avatar-body\">\r\n\t\t\t\t<span>头像：</span>\r\n\t\t\t\t<el-upload\r\n\t\t\t\tclass=\"avatar-uploader\"\r\n\t\t\t\t:action=\"this.action\"\r\n\t\t\t\t:show-file-list=\"false\"\r\n\t\t\t\t:on-success=\"handleAvatarSuccess\"\r\n\t\t\t\t:before-upload=\"beforeAvatarUpload\">\r\n\t\t\t\t<img v-if=\"imageUrl\" :src=\"imageUrl\" class=\"avatar\">\r\n\t\t\t\t<i v-else class=\"el-icon-plus avatar-uploader-icon\"></i>\r\n\t\t\t\t</el-upload>\r\n\t\t\t</div>\r\n\t\t\t<el-button class=\"submit\" type=\"primary\" plain @click=\"submit()\">提交修改</el-button>\r\n\t\t</div>\r\n\t\t<el-dialog title=\"修改密码需要验证旧密码\"\r\n\t\t:visible.sync=\"dialogFormVisible\" \r\n\t\tcenter top=\"45vh\" :modal=\"false\" \r\n\t\t:modal-append-to-body=\"false\"\r\n\t\twidth=\"500px\">\r\n\t\t<el-form >\r\n\t\t\t<el-input\r\n\t\t\ttype=\"textarea\"\r\n\t\t\t:rows=\"2\"\r\n\t\t\tplaceholder=\"请输入旧密码\"\r\n\t\t\tv-model=\"user.psd\">\r\n\t\t\t</el-input>\r\n\t\t</el-form>\r\n\t\t<div slot=\"footer\" class=\"dialog-footer\">\r\n\t\t<el-button @click=\"dialogFormVisible = false\">取 消</el-button>\r\n\t\t<el-button type=\"primary\" @click=\"psd_push()\">确 定</el-button>\r\n\t\t</div>\r\n\t\t</el-dialog>\r\n\t</div>\n</template>\n\n<script>\r\nimport { Storage } from '@/kun/utils/storage'\r\nvar storage = new Storage();\r\nimport Config from '@/config'\r\nimport Admin from '@/kun/api/admin'\r\nexport default {\n\tname: 'UserChange',\r\n\t\r\n\tdata() {\r\n\t\treturn {\r\n\t\t\tdialogFormVisible:false,\r\n\t\t\timageUrl: '',\r\n\t\t\taction:'cms/add_user_avatar',\r\n\t\t\tuser:{\r\n\t\t\t\tappid:'',\r\n\t\t\t\tnew_psd:'',\r\n\t\t\t\tnick_name:'',\r\n\t\t\t\tpsd:'',\r\n\t\t\t\tid:'',\r\n\t\t\t\tavatar_img_id:''\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\tmethods: {\r\n\t\thandleAvatarSuccess(res, file) {//头像上传成功\r\n\t\t\tthis.imageUrl = URL.createObjectURL(file.raw);\r\n\t\t\tthis.user.avatar_img_id = res.id\r\n\t\t\tthis.$store.getters.token.app.avatar_img_url = res.data\r\n\t\t\tconsole.log('this.$store.getters.token.app.avatar_img_url',this.$store.getters.token.app.avatar_img_url)\r\n\t\t\tthis.$store.dispatch('Home/set_token',this.$store.getters.token)\r\n\t\t},\r\n\t\tbeforeAvatarUpload(file) {//上传前操作\r\n\t\t\tconst isJPG = file.type === 'image/jpeg';\r\n\t\t\tconst isPNG = file.type === 'image/png';\r\n\t\t\tconst isLt2M = file.size / 1024 / 1024 < 2;\r\n\t\t\tconsole.log(file)\r\n\t\t\tif (!isJPG&&!isPNG) {\r\n\t\t\t\tthis.$message.error('上传头像图片只能是 JPG/PNG 格式!');\r\n\t\t\t}\r\n\t\t\tif (!isLt2M) {\r\n\t\t\t\tthis.$message.error('上传头像图片大小不能超过 2MB!');\r\n\t\t\t}\r\n\t\t\treturn isJPG||isPNG && isLt2M ;\r\n\t\t},\r\n\t\tsubmit(){//点击提交修改\r\n\t\t\tif(this.user.new_psd!=''&&this.user.new_psd!=null&&this.user.new_psd.length!=0){\r\n\t\t\t\tthis.dialogFormVisible =  true\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tthis.change_axios()\r\n\t\t},\r\n\t\tpsd_push(){//填了新密码，需要验证旧密码\r\n\t\t\tif(this.user.psd==''||this.user.psd==null||this.user.psd.length==0){\r\n\t\t\t\tthis.$notify.error({\r\n\t\t\t\t\ttitle: '错误',\r\n\t\t\t\t\tmessage: '请填写旧密码再提交'\r\n\t\t\t\t});\r\n\t\t\t\treturn;\r\n\t\t\t}else{\r\n\t\t\t\tthis.change_axios()\r\n\t\t\t}\r\n\t\t},\r\n\t\tasync change_axios(){//用户修改请求\r\n\t\t\tlet result\r\n\t\t\ttry {\r\n\t\t\t\tthis.loading = true\r\n\t\t\t\tresult = await Admin.user_change(this.user)\r\n\t\t\t} catch (e) {\r\n\t\t\t\tthis.loading = false\r\n\t\t\t\tconsole.log(e)\r\n\t\t\t}\r\n\t\t\tif(result.data.state == window.g.SUCCESS_STATE){\r\n\t\t\t\tconsole.log(result)\r\n\t\t\t\tthis.dialogFormVisible =  false\r\n\t\t\t\tthis.$notify({\r\n\t\t\t\t\ttitle: '成功',\r\n\t\t\t\t\tmessage: result.data.msg,\r\n\t\t\t\t\ttype: 'success'\r\n\t\t\t\t});\r\n\t\t\t\tif(result.data.change_psd){\t//如果这次修改修改了密码\r\n\t\t\t\t\tthis.$router.push('/');\r\n\t\t\t\t\tstorage.remove_storage('USER_INFO')\r\n\t\t\t\t}else{\r\n\t\t\t\t\t//empty\r\n\t\t\t\t}\r\n\t\t\t}else{\r\n\t\t\t\tthis.$notify.error({\r\n\t\t\t\t\ttitle: '错误',\r\n\t\t\t\t\tmessage: result.data.msg\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t},\r\n\t},\n\tmounted() {\r\n\t\tthis.action = Config.baseURL + this.action\r\n\t\t// console.log(this.$store.getters.token)\r\n\t\tthis.user.nick_name = this.$store.getters.token.app.nick_name\r\n\t\tthis.user.appid = this.$store.getters.token.app.app_id\r\n\t\tthis.user.id = this.$store.getters.token.app.id\r\n\t\tthis.imageUrl = this.$store.getters.token.app.avatar_img_url\r\n\t\tconsole.log('this.imageUrl',this.imageUrl)\r\n\t}\n}\n</script>\n\n<!-- Add \"scoped\" attribute to limit CSS to this component only -->\n<style scoped lang=\"scss\">\r\n.user{\r\n\t.bc{\r\n\t\t\r\n\t\tmargin: 20px;\r\n\t\twidth: calc(100% - 40px);\r\n\t\tmargin-bottom: 0;\r\n\t}\r\n\t.center{\r\n\t\twidth: 500px;\r\n\t\tmargin: 0 auto;\r\n\t\t.input-body{\r\n\t\t\ttext-align: left;\r\n\t\t\tmargin-bottom: 20px;\r\n\t\t\t::v-deep .el-input{\r\n\t\t\t\tmargin-top: 10px;\r\n\t\t\t}\r\n\t\t}\r\n\t\t.avatar-body{\r\n\t\t\tdisplay: flex;\r\n\t\t\t::v-deep .avatar-uploader .el-upload {\r\n\t\t\t\tborder: 1px dashed #d9d9d9;\r\n\t\t\t\tborder-radius: 6px;\r\n\t\t\t\tcursor: pointer;\r\n\t\t\t\tposition: relative;\r\n\t\t\t\toverflow: hidden;\r\n\t\t\t}\r\n\t\t\t::v-deep .avatar-uploader .el-upload:hover {\r\n\t\t\t\tborder-color: #409EFF;\r\n\t\t\t}\r\n\t\t\t::v-deep .avatar-uploader-icon {\r\n\t\t\t\tfont-size: 28px;\r\n\t\t\t\tcolor: #8c939d;\r\n\t\t\t\twidth: 178px;\r\n\t\t\t\theight: 178px;\r\n\t\t\t\tline-height: 178px;\r\n\t\t\t\ttext-align: center;\r\n\t\t\t}\r\n\t\t\t::v-deep .avatar {\r\n\t\t\t\twidth: 178px;\r\n\t\t\t\theight: 178px;\r\n\t\t\t\tdisplay: block;\r\n\t\t\t\t\r\n\t\t\t}\r\n\t\t}\r\n\t\t.submit{\r\n\t\t\tmargin-top: 20px;\r\n\t\t}\r\n\t}\r\n}\n\r\n\r\n// /deep/.markdown-body img{\r\n// \tmax-width: 50%;\r\n// }\n</style>\n"]}]}